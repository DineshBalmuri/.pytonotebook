import nbformat

def convert_py_to_ipynb(py_file_path, ipynb_file_path):
    with open(py_file_path, 'r') as py_file:
        lines = py_file.readlines()
    
    notebook = nbformat.v4.new_notebook()
    cells = []
    current_cell = []
    
    for line in lines:
        stripped_line = line.strip()
        
        if "SQL(" in stripped_line:
            if current_cell:
                cells.append(nbformat.v4.new_code_cell("".join(current_cell)))
            current_cell = [line]
        else:
            current_cell.append(line)
        
        if "write.mode(" in stripped_line or "createorreplacetempview" in stripped_line:
            cells.append(nbformat.v4.new_code_cell("".join(current_cell)))
            current_cell = []
    
    if current_cell:
        cells.append(nbformat.v4.new_code_cell("".join(current_cell)))
    
    notebook.cells = cells
    
    with open(ipynb_file_path, 'w') as ipynb_file:
        nbformat.write(notebook, ipynb_file)
    
    print(f"Jupyter Notebook saved as {ipynb_file_path}")
